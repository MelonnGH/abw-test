<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ABW 2025 Extended ‚Äî Clickable Campaign</title>
  <style>
    :root { --bg:#0b0f14; --panel:#101826; --muted:#98a2b3; --text:#e6eaf2; --accent:#7cdbff; --good:#6ee7b7; --bad:#fb7185; --warn:#fbbf24; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:linear-gradient(180deg,#060a0f, #0b0f14);color:var(--text);}
    header{padding:18px 18px 12px;border-bottom:1px solid rgba(255,255,255,.08);position:sticky;top:0;background:rgba(11,15,20,.85);backdrop-filter: blur(10px);}
    h1{margin:0;font-size:18px;letter-spacing:.2px}
    .sub{margin-top:6px;color:var(--muted);font-size:13px;line-height:1.35}
    main{max-width:980px;margin:0 auto;padding:18px;display:grid;gap:14px}
    .grid{display:grid;gap:14px}
    @media(min-width:920px){ .grid{grid-template-columns: 1.2fr .8fr; align-items:start;} }
    .card{background:rgba(16,24,38,.85);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:14px 14px 12px;box-shadow: 0 10px 30px rgba(0,0,0,.25);}
    .card h2{margin:0 0 10px;font-size:15px}
    .meta{display:flex;flex-wrap:wrap;gap:10px;color:var(--muted);font-size:13px}
    .pill{padding:4px 9px;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);}
    .step-title{display:flex;align-items:baseline;gap:10px}
    .step-title .when{color:var(--accent);font-weight:600}
    .desc{color:var(--text);opacity:.92;font-size:14px;line-height:1.5;margin:10px 0 12px}
    .choices{display:grid;gap:10px}
    button.choice{
      width:100%;text-align:left;
      border-radius:12px;padding:12px 12px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.05);
      color:var(--text);cursor:pointer;
      transition: transform .05s ease, background .12s ease, border-color .12s ease;
      font-size:14px;line-height:1.35;
    }
    button.choice:hover{background:rgba(255,255,255,.08);border-color:rgba(124,219,255,.35)}
    button.choice:active{transform:scale(.99)}
    .delta{font-weight:700}
    .delta.good{color:var(--good)}
    .delta.bad{color:var(--bad)}
    .delta.neutral{color:var(--muted)}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .row button{
      border-radius:12px;padding:10px 12px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.04);
      color:var(--text);cursor:pointer;font-size:13px;
    }
    .row button:hover{background:rgba(255,255,255,.07)}
    .log{max-height:330px;overflow:auto;padding-right:6px}
    .entry{padding:10px 10px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03);margin-bottom:10px}
    .entry .k{font-weight:700}
    .entry .k.good{color:var(--good)} .entry .k.bad{color:var(--bad)} .entry .k.neutral{color:var(--muted)}
    .entry .t{color:var(--muted);font-size:12px;margin-top:4px;line-height:1.35}
    .ending{padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:rgba(255,255,255,.04);}
    .ending h3{margin:0 0 6px;font-size:14px}
    .ending p{margin:0;color:var(--text);opacity:.92;line-height:1.5}
    a.small{color:var(--accent);text-decoration:none}
    a.small:hover{text-decoration:underline}
    footer{max-width:980px;margin:0 auto;padding:0 18px 20px;color:var(--muted);font-size:12px}
    code{background:rgba(255,255,255,.06);padding:1px 6px;border-radius:7px}
  </style>
</head>
<body>
<header>
  <h1>ABW 2025 Extended ‚Äî Clickable Campaign</h1>
  <div class="sub">
    Make choices, earn karma, reach an ending in 2025. Works offline as a single HTML file.
    (<a class="small" href="https://abw.blue/index_en.php" target="_blank" rel="noopener">ABW reference site</a>)
  </div>
</header>

<main class="grid">
  <section class="card" id="play">
    <div class="meta" style="margin-bottom:10px">
      <span class="pill">Step: <span id="stepNum">1</span>/<span id="stepTotal">0</span></span>
      <span class="pill">Karma: <span id="karma">0</span></span>
      <span class="pill">Difficulty: <span id="diff">Balanced</span></span>
    </div>

    <div class="step-title">
      <div class="when" id="when"></div>
      <h2 id="title" style="margin:0"></h2>
    </div>
    <div class="desc" id="desc"></div>

    <div class="choices" id="choices"></div>

    <div class="row">
      <button id="backBtn" onclick="goBack()" title="Undo last choice">‚Üê Back</button>
      <button onclick="restart()">Restart</button>
      <button onclick="toggleDifficulty()">Toggle difficulty</button>
      <button onclick="exportRun()">Export run</button>
    </div>

    <div style="margin-top:10px;color:var(--muted);font-size:12px;line-height:1.45">
      Tip: Use <code>Toggle difficulty</code> for harsher/softer scoring. Your choices are saved to your browser (localStorage).
    </div>
  </section>

  <aside class="card">
    <h2>Run Log</h2>
    <div class="log" id="log"></div>
    <div class="ending" id="ending" style="display:none;margin-top:12px"></div>
  </aside>
</main>

<footer>
  Built for ‚ÄúA Better World‚Äù style alternate-history play. This is a fan-made extension to 2025 (not official ABW software).
</footer>

<script>
  // ---------- Data ----------
  const steps = [
    {
      when: "800 AD",
      title: "Coronation of Charlemagne",
      desc: "Europe‚Äôs political DNA forms here. You can push toward unity and constraints on power, or leave history unchanged.",
      choices: [
        { text: "A) Build a constitutional union that limits war between successor states.", baseDelta: +5,
          result: "Earlier institutions reduce dynastic warfare and normalize shared rules." },
        { text: "B) Let history proceed as it did.", baseDelta: 0,
          result: "No intervention; later fragmentation and rivalry remain likely." },
      ]
    },
    {
      when: "1804",
      title: "Haitian Independence & Global Response",
      desc: "The first successful slave revolt state faces isolation or recognition. Your choice influences abolition momentum worldwide.",
      choices: [
        { text: "A) Recognize Haiti and coordinate fair trade + reconstruction aid.", baseDelta: +5,
          result: "Legitimacy and economic stability strengthen abolition movements elsewhere." },
        { text: "B) Suppress or isolate Haiti to protect colonial interests.", baseDelta: -3,
          result: "Human suffering rises; abolition slows; future revolts become bloodier." },
      ]
    },
    {
      when: "1868",
      title: "Meiji Restoration (Japan‚Äôs modernization)",
      desc: "You can steer modernization toward cooperative development, or allow a more militarized trajectory.",
      choices: [
        { text: "A) Encourage peaceful industrialization and trade-focused diplomacy.", baseDelta: +3,
          result: "Economic growth with less expansionism reduces future conflict risk." },
        { text: "B) Stay hands-off.", baseDelta: 0,
          result: "Outcomes depend on regional tensions and internal power dynamics." },
      ]
    },
    {
      when: "1914‚Äì1918",
      title: "World War I",
      desc: "A massive inflection point for nationalism, empires, and future extremist movements.",
      choices: [
        { text: "A) Prevent WWI via crisis diplomacy + de-escalation mechanisms.", baseDelta: +5,
          result: "Fewer casualties; a slower, negotiated transition away from empire politics." },
        { text: "B) Let WWI proceed as it did.", baseDelta: 0,
          result: "History‚Äôs destructive path continues; downstream instability remains." },
        { text: "C) Prolong the war for ‚Äòdecisive victory‚Äô.", baseDelta: -5,
          result: "Higher death toll + deeper resentments seed harsher ideologies." },
      ]
    },
    {
      when: "1918‚Äì1920",
      title: "Spanish Flu & Global Public Health",
      desc: "You can invest early in global surveillance, transparent reporting, and medical capacity‚Äîor ignore the warning signs.",
      choices: [
        { text: "A) Fund a global health network and rapid-response clinics pre-1918.", baseDelta: +5,
          result: "Lower mortality and a lasting culture of public health preparedness." },
        { text: "B) Minimal coordination; leave responses fragmented.", baseDelta: -5,
          result: "Higher mortality and weaker trust in institutions." },
      ]
    },
    {
      when: "1939‚Äì1945",
      title: "World War II",
      desc: "Your intervention affects the scale and duration of the war, and the postwar order.",
      choices: [
        { text: "A) Accelerate defeat of Axis with targeted aid + postwar reconciliation plan.", baseDelta: +5,
          result: "War ends sooner; reconstruction reduces cycles of revenge." },
        { text: "B) Let history play out.", baseDelta: 0,
          result: "The existing timeline‚Äôs horrors and rebuilding still occur." },
        { text: "C) Enable an Axis victory.", baseDelta: -10,
          result: "Authoritarianism dominates; long-term rights and stability collapse." },
      ]
    },
    {
      when: "1950",
      title: "Create a Global Health & Tech Union",
      desc: "Cold War rivalry can be softened by shared goals: vaccines, infrastructure, education, and open science.",
      choices: [
        { text: "A) Establish a UN-like health+tech union with pooled R&D and equitable access.", baseDelta: +5,
          result: "Better baseline health, literacy, and cooperation reduce conflict triggers." },
        { text: "B) Keep cooperation limited; let rivalry dominate.", baseDelta: -3,
          result: "Duplication and distrust slow progress and raise proxy conflict risk." },
      ]
    },
    {
      when: "1961‚Äì1977",
      title: "Space Race: Moon Only or Mars + Green Tech",
      desc: "Symbolic prestige can become practical progress if paired with sustainability and long-term exploration.",
      choices: [
        { text: "A) Use space budgets to accelerate renewables + begin Mars program.", baseDelta: +5,
          result: "Earlier clean-tech scaling reduces emissions and sparks new science." },
        { text: "B) Moon-first prestige program only.", baseDelta: 0,
          result: "Scientific wins, but weaker spillover into energy transformation." },
      ]
    },
    {
      when: "1991‚Äì1999",
      title: "Internet Governance",
      desc: "The internet‚Äôs rules decide who benefits: open access and privacy, or heavy gatekeeping and surveillance capitalism.",
      choices: [
        { text: "A) Enshrine privacy, encryption, net neutrality, and universal access.", baseDelta: +5,
          result: "Innovation grows while reducing manipulation and inequality." },
        { text: "B) Allow a corporate-gated model with weak privacy norms.", baseDelta: -3,
          result: "Concentration of power increases; misinformation becomes easier to exploit." },
      ]
    },
    {
      when: "2012‚Äì2019",
      title: "AI Ethics & Safety Standards",
      desc: "Early rules can steer AI toward public benefit‚Äîor allow a race-to-the-bottom in deployment.",
      choices: [
        { text: "A) Adopt global AI safety standards, audits, and accountability.", baseDelta: +5,
          result: "Fewer harms and stronger trust; innovation continues under guardrails." },
        { text: "B) Let industry self-regulate with minimal oversight.", baseDelta: -3,
          result: "Short-term speed, long-term backlash and higher systemic risk." },
      ]
    },
    {
      when: "2020",
      title: "Climate Pact Implementation",
      desc: "Ambition is meaningless without implementation. This is the decade that decides the slope of future risk.",
      choices: [
        { text: "A) Rapid renewables buildout + carbon pricing + adaptation funding.", baseDelta: +5,
          result: "Emissions bend downward; resilient infrastructure reduces disaster impact." },
        { text: "B) Delay action; prioritize short-term energy politics.", baseDelta: -5,
          result: "Worse heat, floods, and instability; later fixes become more expensive." },
      ]
    },
    {
      when: "2020‚Äì2021",
      title: "Global Pandemic Response",
      desc: "Public health succeeds when trust and coordination win. You decide the world‚Äôs level of solidarity.",
      choices: [
        { text: "A) Coordinate equitable vaccines + transparent data + manufacturing scale-up.", baseDelta: +5,
          result: "Fewer deaths and variants; faster recovery; less geopolitical bitterness." },
        { text: "B) Vaccine nationalism and hoarding.", baseDelta: -3,
          result: "Longer pandemic tail; higher inequality and mistrust." },
      ]
    },
    {
      when: "2025",
      title: "Digital Democracy Reform",
      desc: "You can modernize governance with verified participation and anti-corruption tools‚Äîor keep politics vulnerable to manipulation.",
      choices: [
        { text: "A) Adopt secure digital participation + transparency + civic AI assistants.", baseDelta: +5,
          result: "Higher participation and institutional legitimacy; slower corruption." },
        { text: "B) Keep current systems with minor tweaks.", baseDelta: 0,
          result: "Stability, but less resilience against future information warfare." },
      ]
    }
  ];

  const endings = [
    {
      name: "üåü Utopian Future",
      range: [50, 9999],
      text: "Cooperation becomes normal. Major diseases are curtailed, climate risk is reduced, and democratic institutions evolve to match a networked world. You didn‚Äôt make things perfect‚Äîbut you made progress ‚Äòsticky‚Äô."
    },
    {
      name: "üü¢ Stable World",
      range: [20, 49],
      text: "The world is better than baseline, but uneven. Climate action is partial, tech benefits are shared in some places, and geopolitics remains tense. You built a platform for improvement rather than a final victory."
    },
    {
      name: "üî• Dystopian Drift",
      range: [-9999, 19],
      text: "Fragmentation wins. Crises compound‚Äîclimate shocks, misinformation, weak institutions, and mistrust. Reform is still possible, but the cost is much higher. Next run: prioritize cooperation + guardrails."
    }
  ];

  // ---------- State ----------
  const defaultState = {
    idx: 0,
    karma: 0,
    history: [], // {stepIdx, choiceIdx, delta, note, when, title, choiceText}
    difficulty: "Balanced" // Balanced | Gentle | Harsh
  };

  let state = loadState();

  function difficultyMultiplier() {
    if (state.difficulty === "Gentle") return 0.75;
    if (state.difficulty === "Harsh") return 1.25;
    return 1.0;
  }

  function applyDelta(baseDelta) {
    // Keep 0 as 0; scale nonzero deltas and round to nearest integer.
    if (baseDelta === 0) return 0;
    return Math.round(baseDelta * difficultyMultiplier());
  }

  // ---------- Persistence ----------
  function saveState() {
    localStorage.setItem("abw2025_state", JSON.stringify(state));
  }
  function loadState() {
    try {
      const raw = localStorage.getItem("abw2025_state");
      if (!raw) return structuredClone(defaultState);
      const parsed = JSON.parse(raw);
      // minimal validation
      if (typeof parsed.idx !== "number" || typeof parsed.karma !== "number") return structuredClone(defaultState);
      return parsed;
    } catch {
      return structuredClone(defaultState);
    }
  }

  // ---------- UI ----------
  const stepTotalEl = document.getElementById("stepTotal");
  const stepNumEl = document.getElementById("stepNum");
  const whenEl = document.getElementById("when");
  const titleEl = document.getElementById("title");
  const descEl = document.getElementById("desc");
  const choicesEl = document.getElementById("choices");
  const karmaEl = document.getElementById("karma");
  const logEl = document.getElementById("log");
  const endingEl = document.getElementById("ending");
  const diffEl = document.getElementById("diff");
  const backBtn = document.getElementById("backBtn");

  stepTotalEl.textContent = steps.length;

  function render() {
    diffEl.textContent = state.difficulty;
    karmaEl.textContent = state.karma;
    stepNumEl.textContent = Math.min(state.idx + 1, steps.length);

    backBtn.disabled = state.history.length === 0;
    backBtn.style.opacity = backBtn.disabled ? 0.5 : 1;
    backBtn.style.cursor = backBtn.disabled ? "not-allowed" : "pointer";

    renderLog();

    if (state.idx >= steps.length) {
      renderEnding();
      document.getElementById("play").scrollIntoView({behavior:"smooth", block:"start"});
      return;
    }

    endingEl.style.display = "none";
    const step = steps[state.idx];
    whenEl.textContent = step.when;
    titleEl.textContent = step.title;
    descEl.textContent = step.desc;

    choicesEl.innerHTML = "";
    step.choices.forEach((c, i) => {
      const delta = applyDelta(c.baseDelta);
      const span = document.createElement("span");
      span.className = "delta " + (delta > 0 ? "good" : delta < 0 ? "bad" : "neutral");
      span.textContent = (delta > 0 ? `+${delta}` : `${delta}`);

      const btn = document.createElement("button");
      btn.className = "choice";
      btn.onclick = () => choose(i);

      btn.innerHTML = `
        <div style="display:flex;justify-content:space-between;gap:10px;align-items:flex-start">
          <div style="flex:1">${escapeHtml(c.text)}</div>
          <div style="white-space:nowrap">${span.outerHTML}</div>
        </div>
        <div style="margin-top:6px;color:var(--muted);font-size:12px;line-height:1.35">${escapeHtml(c.result)}</div>
      `;
      choicesEl.appendChild(btn);
    });
  }

  function renderLog() {
    logEl.innerHTML = "";
    if (state.history.length === 0) {
      logEl.innerHTML = `<div class="entry"><div class="t">No choices yet. Start playing on the left.</div></div>`;
      return;
    }
    state.history.slice().reverse().forEach((h, revIdx) => {
      const kClass = h.delta > 0 ? "good" : h.delta < 0 ? "bad" : "neutral";
      const e = document.createElement("div");
      e.className = "entry";
      e.innerHTML = `
        <div><span class="k ${kClass}">${h.delta > 0 ? "+"+h.delta : h.delta}</span> ‚Äî <strong>${escapeHtml(h.when)}</strong> ¬∑ ${escapeHtml(h.title)}</div>
        <div class="t">${escapeHtml(h.choiceText)}</div>
      `;
      logEl.appendChild(e);
    });
  }

  function renderEnding() {
    const score = state.karma;
    const end = endings.find(e => score >= e.range[0] && score <= e.range[1]) || endings[endings.length - 1];
    endingEl.style.display = "block";
    endingEl.innerHTML = `
      <h3>${end.name}</h3>
      <p><strong>Final Karma:</strong> ${score}</p>
      <p style="margin-top:8px">${escapeHtml(end.text)}</p>
      <p style="margin-top:10px;color:var(--muted);font-size:12px;line-height:1.45">
        Want a different ending? Try <em>Gentle</em> difficulty for less punishing negatives, or <em>Harsh</em> for higher stakes.
      </p>
    `;
    // Clear play panel
    whenEl.textContent = "Finished";
    titleEl.textContent = "Campaign complete (2025)";
    descEl.textContent = "Restart to play again, or export your run to share your timeline.";
    choicesEl.innerHTML = "";
  }

  // ---------- Actions ----------
  function choose(choiceIdx) {
    const step = steps[state.idx];
    const choice = step.choices[choiceIdx];
    const delta = applyDelta(choice.baseDelta);

    state.karma += delta;
    state.history.push({
      stepIdx: state.idx,
      choiceIdx,
      delta,
      when: step.when,
      title: step.title,
      choiceText: choice.text
    });
    state.idx += 1;

    saveState();
    render();
  }

  function goBack() {
    if (state.history.length === 0) return;
    const last = state.history.pop();
    state.karma -= last.delta;
    state.idx = last.stepIdx;
    saveState();
    render();
  }

  function restart() {
    state = structuredClone(defaultState);
    saveState();
    render();
  }

  function toggleDifficulty() {
    const order = ["Balanced", "Gentle", "Harsh"];
    const i = order.indexOf(state.difficulty);
    state.difficulty = order[(i + 1) % order.length];
    saveState();
    render();
  }

  function exportRun() {
    const data = {
      difficulty: state.difficulty,
      finalKarma: state.karma,
      choices: state.history.map(h => ({
        when: h.when,
        title: h.title,
        choice: h.choiceText,
        delta: h.delta
      }))
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "abw_2025_run.json";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  // ---------- Helpers ----------
  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  // ---------- Init ----------
  render();
</script>
</body>
</html>
